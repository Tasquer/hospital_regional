{% extends 'components/Layout/base_extendido.html' %}

{% block content_main %}
<section class="space-y-6 text-white">
  <div class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <p class="text-sm font-semibold text-indigo-300 uppercase tracking-wide">Caso clínico</p>
      <h1 class="text-3xl font-bold text-white">{{ caso.titulo }}</h1>
      <p class="text-sm text-gray-400">
        Paciente: <span class="font-semibold text-white">{{ caso.paciente.nombre_completo }}</span> · {{ caso.paciente.rut }}
      </p>
    </div>
    <div class="flex flex-wrap gap-3">
      <a href="{% url 'clinica:caso_update' caso.pk %}" class="rounded-2xl border border-white/15 px-4 py-2 text-sm font-semibold text-gray-200 hover:bg-white/5">
        Editar caso
      </a>
      <a href="{% url 'clinica:caso_list' %}" class="rounded-2xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-600/30 hover:bg-indigo-500">
        Volver al listado
      </a>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <section class="rounded-3xl border border-white/10 bg-slate-900/70 p-6 shadow-2xl shadow-black/20 lg:col-span-2 space-y-4">
      <div class="flex flex-wrap items-center gap-3 text-xs font-semibold">
        <span class="inline-flex items-center gap-2 rounded-full px-3 py-1
          {% if caso.estado == 'cerrado' %}bg-gray-500/10 text-gray-300{% elif caso.estado == 'en_estudio' %}bg-indigo-500/10 text-indigo-200{% else %}bg-sky-500/10 text-sky-200{% endif %}">
          <span class="h-2 w-2 rounded-full
            {% if caso.estado == 'cerrado' %}bg-gray-400{% elif caso.estado == 'en_estudio' %}bg-indigo-300{% else %}bg-sky-300{% endif %}"></span>
          {{ caso.get_estado_display }}
        </span>
        <span class="inline-flex items-center gap-2 rounded-full px-3 py-1
          {% if caso.prioridad == 'alta' %}bg-rose-500/10 text-rose-300{% elif caso.prioridad == 'media' %}bg-amber-500/10 text-amber-200{% else %}bg-emerald-500/10 text-emerald-200{% endif %}">
          <span class="h-2 w-2 rounded-full
            {% if caso.prioridad == 'alta' %}bg-rose-400{% elif caso.prioridad == 'media' %}bg-amber-300{% else %}bg-emerald-300{% endif %}"></span>
          Prioridad: {{ caso.get_prioridad_display }}
        </span>
        <span class="rounded-full bg-white/5 px-3 py-1 text-gray-400">Creado {{ caso.fecha_creacion|date:"d/m/Y H:i" }}</span>
      </div>
      <article class="space-y-3">
        <h2 class="text-lg font-semibold text-white">Resumen</h2>
        <p class="text-sm leading-6 text-gray-200 whitespace-pre-line">{{ caso.resumen }}</p>
      </article>
    </section>

    <aside class="rounded-3xl border border-white/10 bg-slate-900/70 p-6 shadow-2xl shadow-black/20 space-y-4">
      <h2 class="text-lg font-semibold text-white">Detalles</h2>
      <dl class="divide-y divide-white/10 text-sm text-gray-300">
        <div class="flex justify-between py-3">
          <dt class="text-gray-400">Especialidad</dt>
          <dd class="text-white">{{ caso.especialidad }}</dd>
        </div>
        <div class="flex justify-between py-3">
          <dt class="text-gray-400">Médico responsable</dt>
          <dd class="text-white">{{ caso.medico_responsable.get_full_name|default:caso.medico_responsable }}</dd>
        </div>
        <div class="flex justify-between py-3">
          <dt class="text-gray-400">Última actualización</dt>
          <dd class="text-white">{{ caso.fecha_actualizacion|date:"d/m/Y H:i" }}</dd>
        </div>
      </dl>
    </aside>
  </div>

  <div class="rounded-3xl border border-white/10 bg-slate-900/70 p-6 shadow-2xl shadow-black/20 space-y-4">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold text-white">Paciente</h2>
        <p class="text-sm text-gray-400">Información de contacto y acceso rápido a la ficha.</p>
      </div>
      <a href="{% url 'clinica:paciente_detail' caso.paciente.pk %}" class="rounded-2xl border border-white/15 px-4 py-2 text-sm font-semibold text-gray-200 hover:bg-white/5">
        Ver ficha completa
      </a>
    </div>
    <div class="grid gap-4 text-sm text-gray-300 md:grid-cols-3">
      <div>
        <p class="text-gray-400">Nombre</p>
        <p class="text-white">{{ caso.paciente.nombre_completo }}</p>
      </div>
      <div>
        <p class="text-gray-400">Teléfono</p>
        <p class="text-white">{{ caso.paciente.telefono|default:"Sin teléfono" }}</p>
      </div>
      <div>
        <p class="text-gray-400">Correo</p>
        <p class="text-white">{{ caso.paciente.email|default:"Sin correo" }}</p>
      </div>
      <div class="md:col-span-3">
        <p class="text-gray-400">Dirección</p>
        <p class="text-white">{{ caso.paciente.direccion|default:"No registrada" }}</p>
      </div>
    </div>
  </div>

  {% include 'components/mensajes.html' %}
</section>
{% endblock content_main %}
