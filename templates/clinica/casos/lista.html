{% extends 'components/Layout/base_extendido.html' %}

{% block content_main %}
<section class="space-y-6 text-white">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <p class="text-sm font-semibold text-indigo-300 uppercase tracking-wide">Módulo clínico</p>
      <h1 class="text-3xl font-bold text-white">Casos clínicos</h1>
      <p class="text-sm text-gray-400">Monitorea la carga asistencial, prioriza seguimientos y coordina al equipo médico.</p>
    </div>
    <a href="{% url 'clinica:caso_create' %}" class="inline-flex items-center gap-2 rounded-full bg-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-indigo-600/30 transition hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">
      <span class="text-lg leading-none">+</span>
      Nuevo caso clínico
    </a>
  </div>

  <div class="rounded-[2.5rem] border border-white/10 bg-gray-950/40 p-1 shadow-2xl shadow-black/30">
    <div class="overflow-x-auto rounded-[2rem]">
      <div class="overflow-hidden rounded-[2rem]">
        <table aria-label="Casos clínicos" class="w-full whitespace-nowrap text-left text-sm text-gray-300">
        <colgroup>
          <col class="w-full lg:w-4/12">
          <col class="lg:w-3/12">
          <col class="lg:w-2/12">
          <col class="lg:w-2/12">
          <col class="lg:w-1/12">
        </colgroup>
        <thead class="border-b border-white/10 text-xs font-semibold uppercase tracking-wide text-gray-400">
          <tr>
            <th scope="col" class="py-3 pl-6 pr-8 sm:pl-8">Título</th>
            <th scope="col" class="px-6 py-3">Paciente</th>
            <th scope="col" class="px-6 py-3">Especialidad</th>
            <th scope="col" class="px-6 py-3">Prioridad</th>
            <th scope="col" class="px-6 py-3">Estado</th>
            <th scope="col" class="py-3 pl-6 pr-6 text-right sm:pr-8">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-white/5 text-sm leading-6">
          {% for caso in casos %}
            <tr class="transition hover:bg-white/5">
              <td class="py-4 pl-6 pr-8 sm:pl-8">
                <p class="text-base font-semibold text-white">{{ caso.titulo }}</p>
                <p class="text-xs text-gray-400 line-clamp-2">{{ caso.resumen }}</p>
              </td>
              <td class="px-6 py-4">
                <p class="font-medium text-gray-200">{{ caso.paciente.nombre_completo }}</p>
                <p class="text-xs text-gray-500">{{ caso.paciente.rut }}</p>
              </td>
              <td class="px-6 py-4 text-sm text-gray-200">{{ caso.especialidad }}</td>
              <td class="px-6 py-4">
                {% if caso.prioridad == 'alta' %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-rose-500/10 px-3 py-1 text-xs font-semibold text-rose-300">
                    <span class="h-2 w-2 rounded-full bg-rose-400"></span> Alta
                  </span>
                {% elif caso.prioridad == 'media' %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-amber-500/10 px-3 py-1 text-xs font-semibold text-amber-200">
                    <span class="h-2 w-2 rounded-full bg-amber-300"></span> Media
                  </span>
                {% else %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200">
                    <span class="h-2 w-2 rounded-full bg-emerald-300"></span> Baja
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4">
                {% if caso.estado == 'cerrado' %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-gray-500/10 px-3 py-1 text-xs font-semibold text-gray-300">
                    <span class="h-2 w-2 rounded-full bg-gray-400"></span> Cerrado
                  </span>
                {% elif caso.estado == 'en_estudio' %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-indigo-500/10 px-3 py-1 text-xs font-semibold text-indigo-200">
                    <span class="h-2 w-2 rounded-full bg-indigo-300"></span> En estudio
                  </span>
                {% else %}
                  <span class="inline-flex items-center gap-2 rounded-full bg-sky-500/10 px-3 py-1 text-xs font-semibold text-sky-200">
                    <span class="h-2 w-2 rounded-full bg-sky-300"></span> Abierto
                  </span>
                {% endif %}
              </td>
              <td class="py-4 pl-6 pr-6 text-right text-sm font-semibold sm:pr-8">
                <div class="flex justify-end gap-4 text-indigo-300">
                  <a href="{% url 'clinica:caso_detail' caso.pk %}" class="hover:text-white">Ver</a>
                  <a href="{% url 'clinica:caso_update' caso.pk %}" class="text-gray-400 hover:text-white">Editar</a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="px-6 py-10 text-center text-sm text-gray-400">
                No hay casos clínicos registrados. <a href="{% url 'clinica:caso_create' %}" class="text-indigo-300 underline-offset-4 hover:text-indigo-200 hover:underline">Crea el primero</a>.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </div>

    {% include 'components/paginador.html' with page_obj=page_obj %}
  </div>

  {% include 'components/mensajes.html' %}
</section>
{% endblock content_main %}
